apiVersion: serving.kserve.io/v1beta1
kind: InferenceService
metadata:
  name: rollout-strategy-test
  namespace: default
  annotations:
    serving.kserve.io/deploymentMode: "RawDeployment"
spec:
  predictor:
    model:
      modelFormat:
        name: sklearn
      storageUri: "s3://test-bucket/model"
    # Test Availability Mode deployment strategy (zero downtime)
    deploymentStrategy:
      type: RollingUpdate
      rollingUpdate:
        maxUnavailable: "0"      # Availability mode - no downtime
        maxSurge: "50%"          # Can create 50% more pods during rollout
    
  transformer:
    custom:
      container:
        image: test-transformer:latest
    # Test ResourceAware Mode deployment strategy (resource efficient)
    deploymentStrategy:
      type: RollingUpdate
      rollingUpdate:
        maxSurge: "0"            # ResourceAware mode - no extra pods
        maxUnavailable: "25%"    # Up to 25% of pods can be unavailable
    
  explainer:
    art:
      type: lime
      name: explainer
    # Test with ConfigMap defaults (no deployment strategy specified)

---
# Test case for ConfigMap defaults
apiVersion: serving.kserve.io/v1beta1
kind: InferenceService
metadata:
  name: rollout-strategy-configmap-test
  namespace: default
  annotations:
    serving.kserve.io/deploymentMode: "RawDeployment"
spec:
  predictor:
    model:
      modelFormat:
        name: sklearn
      storageUri: "s3://test-bucket/model"
    # No deployment strategy - should use ConfigMap defaults when defaultDeploymentMode is "RawDeployment"

---
# Test case for multinode deployment automatic override
apiVersion: serving.kserve.io/v1beta1
kind: InferenceService
metadata:
  name: rollout-strategy-multinode-test
  namespace: default
  annotations:
    serving.kserve.io/deploymentMode: "RawDeployment"
spec:
  predictor:
    model:
      modelFormat:
        name: huggingface
      storageUri: "s3://test-bucket/llm-model"
    containers:
    - name: kserve-container
      image: test-ray-server:latest
      env:
      - name: RAY_NODE_COUNT
        value: "2"
    # This deploymentStrategy will be overridden for multinode
    deploymentStrategy:
      type: RollingUpdate
      rollingUpdate:
        maxUnavailable: "25%"  # Will be overridden to "0%"
        maxSurge: "50%"        # Will be overridden to "100%" 